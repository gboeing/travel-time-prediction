# Instructions on how to reproduce reported findings

These instructions provide step-by-step guidance to reproduce findings reported in the paper, including
- **Table 1. Traffic control elements summary**
- **Table 2. Out-of-sample prediction accuracy of our chosen models**

The workflow now supports multiple network years (e.g., 2023 Baseline and 2025 Robustness).

Change the current working directory to this folder, and in the terminal run `source one_click_run.sh`.

## Default Option: "One-Click Run" (Recommended)
To reproduce the reported results for **both years**, open a terminal in this directory and run: `source one_click_run.sh`

(Optional) To run a specific year: `source one_click_run.sh --year 2023`

This option will
- By default, bypass step 1 & 2 (`01-preprocess_input_data.py` and `02-routes_api.py`) and use instead our pre-queried intermediate data of
  - Drivable street network from OpenStreetMap (OSM)
    - `data/intermediate/2023/LA_clip_convex_strong_network_non_simplify_all_direction_2023.graphml` (and the 2025 version)
  - Travel times from Google Routes API, for training the model.
    - `data/intermediate/OD3am_routes_api.csv`

- Then execute step 3 OD routing (`03-network_routing.py`) and step 4 modeling (`04-modeling.py`).
- #### Step 3 OD routing (`03-network_routing.py`)
  - Generates routing features for all OD pairs sampled in the preprocessed OSM street network.
    - Output: `data/intermediate/<YEAR>/network_routing_result.csv`
  - Generates **Table 1. Traffic control elements summary**
    - Output: `data/output/<YEAR>/table1_traffic_controls.csv`
  - Approximate runtime: ~8 hours on 10 cores

- #### Step 4 modeling (`04-modeling.py`)
  - Chooses the best performing hyperparameters for four machine learning models.
    - Output: `data/output/<YEAR>/best_rf_random_param.csv` (and gb, ab, dt...)
  - Evaluates these models' prediction accuracy. **Note: 2025 robustness check uses the fixed train/test split from 2023.**
    - Output: `data/output/<YEAR>/rf_evaluation_result.csv` (and gb, ab, dt...)
  - Aggregates results to generate **Table 2. Out-of-sample prediction accuracy**
    - Output: `data/output/<YEAR>/table2_combined_evaluation_result.csv`
  - Approximate runtime: ~1 hour

## Alternative Option: Full Pipeline Run-through with Re-query (NOT Recommended)

This option will
- Rerun the entire workflow: `source one_click_run.sh --requery your_own_google_api_key 2025-05-01`

We do not recommend this option for reproducibility because:
  - First, it may provide different results compared with our study.
  - Second, you need to bring an API key.

### Step 1 pre-process input data (`01-preprocess_input_data.py`)
  - **Important:** This step now saves a temporary "working" file: `data/intermediate/LA_clip_convex_strong_network_non_simplify_all_direction_working.graphml`.
  - To use this new network for the pipeline, you must manually rename it to `..._2023.graphml` (or 2025) and move it to the corresponding `data/intermediate/<YEAR>/` folder.
### Step 2 query Google routes' API's travel time (`02-routes_api.py`)
  - Re-queries Google Routes API.

## Folder Structure
```text
.
├── data
│   ├── input
│   │   ├── GHS_STAT_UCDB2015MT_GLOBE_R2019A_V1_2.gpkg
│   │   └── ...
│   ├── intermediate
│   │   ├── la_clip_convex.shp
│   │   ├── OD3am_routes_api.csv
│   │   ├── LA_..._working.graphml                                                     # Temp output from Step 1
│   │   ├── 2023
│   │   │   ├── LA_..._2023.graphml                                                    # Finalized network
│   │   │   ├── network_routing_result.csv                                             # Generated by Step 3
│   │   │   └── test_train_split.csv                                                   # Master split map
│   │   └── 2025
│   │       ├── LA_..._2025.graphml
│   │       └── network_routing_result.csv
│   ├── output
│   │   ├── 2023
│   │   │   ├── best_rf_random_param.csv
│   │   │   ├── rf_evaluation_result.csv
│   │   │   ├── table1_traffic_controls.csv
│   │   │   └── table2_combined_evaluation_result.csv
│   │   └── 2025
│   │       └── ... (same structure as 2023)
│   └── README.md
├── environment.yml
├── instructions.md
├── one_click_run.sh
├── README.md
└── tool
    ├── 01-preprocess_input_data.py
    ├── 02-routes_api.py
    ├── 03-network_routing.py
    ├── 04-modeling.py
    └── constants.py
